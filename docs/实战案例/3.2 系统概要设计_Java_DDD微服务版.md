# 知识图谱可视化与管理平台 - 系统概要设计（Java微服务版）

## 目录
1. [项目概述](#1-项目概述)
2. [微服务架构设计](#2-微服务架构设计)
3. [核心业务服务设计](#3-核心业务服务设计)
4. [基础设施服务设计](#4-基础设施服务设计)
5. [数据架构设计](#5-数据架构设计)
6. [部署架构](#6-部署架构)
7. [安全设计](#7-安全设计)
8. [性能优化](#8-性能优化)
9. [测试策略](#9-测试策略)
10. [迁移策略](#10-迁移策略)
11. [运维指南](#11-运维指南)
12. [项目目录规划](#12-项目目录规划)

## 1. 项目概述

### 1.1 项目背景
基于系统设计需求文档，构建一个基于Java微服务架构的知识图谱可视化与管理平台，实现知识图谱的创建、编辑、可视化、分析和导入导出功能，支持云原生部署和水平扩展。

### 1.2 设计目标
- **技术先进性**: 采用云原生微服务架构，支持水平扩展
- **业务完整性**: 覆盖知识图谱全生命周期管理
- **高可用性**: 99.9%可用性保证，支持故障自愈
- **可扩展性**: 支持新功能模块的快速集成
- **易运维性**: 完整的监控、日志、告警体系

### 1.3 架构原则
- **微服务架构**: 按业务域拆分服务，实现高内聚低耦合
- **云原生设计**: 支持容器化部署和Kubernetes编排
- **事件驱动**: 采用事件溯源和CQRS模式
- **API优先**: 所有功能通过RESTful API暴露
- **数据一致性**: 最终一致性模型，支持分布式事务
- **技术多样性**: 各服务可采用最适合的技术栈

## 2. 微服务架构设计

### 2.1 服务拆分策略
基于领域驱动设计(DDD)和业务能力，将系统拆分为以下微服务：

#### 2.1.1 核心业务服务
| 服务名称 | 业务域 | 主要职责 | 技术栈 |
|---------|--------|----------|--------|
| **知识图谱服务** | 知识管理 | 图谱CRUD、查询、分析 | Spring Boot + JanusGraph |
| **本体管理服务** | 知识建模 | 本体设计、验证、版本管理 | Spring Boot + PostgreSQL |
| **可视化服务** | 展示层 | 图谱渲染、布局算法 | Spring Boot + WebSocket |
| **数据导入服务** | 数据处理 | 多格式数据导入、清洗 | Spring Boot + Apache Camel |
| **邮件处理服务** | 邮件集成 | 邮件接收、解析、实体提取 | Spring Boot + IMAP/POP3 |
| **用户管理服务** | 用户管理 | 用户注册、认证、权限管理 | Spring Boot + PostgreSQL |

#### 2.1.2 基础设施服务
| 服务名称 | 功能 | 技术栈 |
|---------|------|--------|
| **配置中心** | 统一配置管理 | Spring Cloud Config |
| **API网关** | API路由、限流、认证 | Spring Cloud Gateway |
| **服务发现** | 服务注册与发现 | Eureka Server |
| **监控服务** | 应用监控、指标收集 | Micrometer + Prometheus |
| **通知服务** | 邮件、WebSocket通知 | Spring Boot + RabbitMQ |
| **审计服务** | 操作日志、审计追踪 | Spring Boot + PostgreSQL |

### 2.2 技术栈选型

#### 2.2.1 后端技术栈
- **框架**: Spring Boot 3.2.x, Spring Cloud 2023.x
- **图数据库**: JanusGraph 1.0.x (TinkerPop 3.7兼容)
- **存储后端**: 
  - Apache Cassandra 4.1 (分布式存储)
  - Elasticsearch 8.11 (全文索引)
  - Redis 7.x (缓存层)
- **关系数据**: PostgreSQL 15.x
- **消息队列**: RabbitMQ 3.12 / Apache Kafka 3.6
- **监控**: Micrometer + Prometheus 2.48 + Grafana 10.x
- **链路追踪**: Spring Cloud Sleuth + Zipkin

#### 2.2.2 前端技术栈
- **框架**: React 18.2 + TypeScript 5.3
- **状态管理**: Redux Toolkit 2.0 + RTK Query
- **可视化**: D3.js 7.x + AntV G6 4.x + ECharts 5.x
- **UI组件**: Ant Design 5.12
- **构建工具**: Vite 5.x

#### 2.2.3 基础设施
- **容器化**: Docker 24.x + Docker Compose 2.x
- **编排**: Kubernetes 1.29 + Helm 3.13
- **服务网格**: Istio 1.20 (可选)
- **CI/CD**: GitHub Actions / GitLab CI
- **镜像仓库**: Harbor 2.10 / Docker Hub

### 2.3 架构模式

#### 2.3.1 分层架构
```
┌─────────────────────────────────────────┐
│              前端层 (React)               │
├─────────────────────────────────────────┤
│              API网关层                   │
├─────────────────────────────────────────┤
│            微服务层 (Business)           │
├─────────────────────────────────────────┤
│            数据持久化层                 │
├─────────────────────────────────────────┤
│            基础设施层                   │
└─────────────────────────────────────────┘
```

#### 2.3.2 通信模式
- **同步通信**: RESTful API (OpenAPI 3.1)
- **异步通信**: 事件总线 (RabbitMQ/Kafka)
- **实时通信**: WebSocket (STOMP协议)
- **服务发现**: Eureka / Consul

### 2.4 项目目录规划
```
email-agent-java/                           # 根项目 - 邮件知识图谱Java微服务平台
├── services/                               # 微服务目录 - 包含所有核心业务微服务
│   ├── knowledge-graph-service/            # 知识图谱服务 - 核心服务，负责图数据存储和查询
│   │   ├── src/                            # 源代码目录
│   │   │   ├── main/                       # 主程序代码
│   │   │   │   ├── java/                   # Java源码目录
│   │   │   │   │   └── com.emailagent.knowledgegraph/
│   │   │   │   │       ├── KnowledgeGraphApplication.java  # Spring Boot启动类 - 微服务入口点
│   │   │   │   │       ├── domain/                 # 领域层 - DDD核心业务逻辑
│   │   │   │   │       │   ├── model/              # 领域模型 - 核心业务对象
│   │   │   │   │       │   │   ├── GraphNode.java  # 图节点实体 - 表示知识图谱中的节点
│   │   │   │   │       │   │   ├── GraphEdge.java  # 图边实体 - 表示节点间的关系
│   │   │   │   │       │   │   ├── KnowledgeGraph.java # 知识图谱聚合根 - 图数据容器
│   │   │   │   │       │   │   └── vo/             # 值对象 - 不可变数据对象
│   │   │   │   │       │   │       ├── NodeType.java # 节点类型枚举 - 定义节点分类
│   │   │   │   │       │   │       └── RelationshipType.java # 关系类型枚举 - 定义边类型
│   │   │   │   │       │   ├── repository/         # 仓储接口 - 数据访问抽象层
│   │   │   │   │       │   │   ├── GraphNodeRepository.java # 节点仓储接口 - CRUD操作定义
│   │   │   │   │       │   │   └── GraphEdgeRepository.java # 边仓储接口 - 关系操作定义
│   │   │   │   │       │   ├── service/            # 领域服务 - 核心业务逻辑实现
│   │   │   │   │       │   │   ├── GraphTraversalService.java # 图遍历服务 - 路径查找算法
│   │   │   │   │       │   │   └── GraphQueryService.java     # 图查询服务 - 复杂查询逻辑
│   │   │   │   │       │   └── event/              # 领域事件 - 业务事件定义
│   │   │   │   │       │       ├── NodeCreatedEvent.java # 节点创建事件 - 用于事件驱动架构
│   │   │   │   │       │       └── NodeUpdatedEvent.java # 节点更新事件 - 保证数据一致性
│   │   │   │   │       ├── application/            # 应用层 - 应用服务编排
│   │   │   │   │       │   ├── command/            # 命令对象 - CQRS模式中的写操作
│   │   │   │   │       │   │   ├── CreateNodeCommand.java      # 创建节点命令 - 封装创建参数
│   │   │   │   │       │   │   ├── UpdateNodeCommand.java      # 更新节点命令 - 封装更新参数
│   │   │   │   │       │   │   └── CreateRelationshipCommand.java # 创建关系命令 - 关系建立参数
│   │   │   │   │       │   ├── query/              # 查询对象 - CQRS模式中的读操作
│   │   │   │   │       │   │   ├── SearchNodesQuery.java    # 搜索节点查询 - 条件搜索参数
│   │   │   │   │       │   │   ├── GetNodeDetailsQuery.java # 获取节点详情查询 - 单节点查询
│   │   │   │   │       │   │   └── FindPathsQuery.java      # 查找路径查询 - 路径分析参数
│   │   │   │   │       │   ├── handler/            # 命令/查询处理器 - 业务逻辑协调器
│   │   │   │   │       │   │   ├── NodeCommandHandler.java # 节点命令处理器 - 处理写操作
│   │   │   │   │       │   │   └── NodeQueryHandler.java   # 节点查询处理器 - 处理读操作
│   │   │   │   │       │   └── service/            # 应用服务 - 用例协调层
│   │   │   │   │       │       ├── NodeApplicationService.java         # 节点应用服务 - 节点相关用例
│   │   │   │   │       │       └── GraphTraversalApplicationService.java # 图遍历应用服务 - 图分析用例
│   │   │   │   │       ├── infrastructure/         # 基础设施层 - 技术实现细节
│   │   │   │   │       │   ├── config/             # 配置类 - 框架集成配置
│   │   │   │   │       │   │   ├── JanusGraphConfig.java # Janus图数据库配置 - 连接和参数设置
│   │   │   │   │       │   │   ├── GremlinConfig.java    # Gremlin查询引擎配置 - 图查询优化
│   │   │   │   │       │   │   └── CacheConfig.java      # 缓存配置 - Redis缓存策略
│   │   │   │   │       │   ├── persistence/        # 持久化实现 - 数据访问具体实现
│   │   │   │   │       │   │   ├── JanusGraphNodeRepository.java # Janus图节点仓储实现
│   │   │   │   │       │   │   └── GraphTraversalRepository.java # 图遍历仓储实现
│   │   │   │   │       │   ├── messaging/          # 消息处理 - 事件发布订阅
│   │   │   │   │       │   │   └── EventPublisher.java # 事件发布器 - 领域事件发布
│   │   │   │   │       │   └── security/           # 安全配置 - 认证授权实现
│   │   │   │   │       │       └── SecurityConfig.java # Spring Security配置 - 安全策略
│   │   │   │   │       └── interfaces/             # 接口层 - 外部交互接口
│   │   │   │   │           ├── rest/               # REST API - HTTP接口
│   │   │   │   │           │   ├── KnowledgeGraphController.java # 知识图谱REST控制器 - 图数据API
│   │   │   │   │           │   ├── NodeController.java           # 节点REST控制器 - 节点操作API
│   │   │   │   │           │   └── GraphTraversalController.java # 图遍历REST控制器 - 分析API
│   │   │   │   │           ├── websocket/          # WebSocket接口 - 实时通信
│   │   │   │   │           │   └── GraphUpdateWebSocket.java # 图更新WebSocket - 实时数据推送
│   │   │   │   │           └── graphql/          # GraphQL接口 - 灵活查询
│   │   │   │   │               └── GraphQLProvider.java # GraphQL提供者 - 模式定义
│   │   │   ├── resources/          # 资源配置目录
│   │   │   │   ├── application.yml         # 主配置文件 - Spring Boot配置
│   │   │   │   ├── application-dev.yml     # 开发环境配置 - 开发专用设置
│   │   │   │   ├── application-prod.yml    # 生产环境配置 - 生产优化参数
│   │   │   │   └── logback-spring.xml    # 日志配置 - 结构化日志格式
│   │   │   └── test/                   # 测试代码目录
│   │   │       ├── unit/               # 单元测试 - 类级别测试
│   │   │       ├── integration/        # 集成测试 - 服务间测试
│   │   │       └── e2e/                # 端到端测试 - 完整业务流程测试
│   │   ├── pom.xml                     # Maven配置 - 依赖管理和构建配置
│   │   └── Dockerfile                  # 容器化配置 - Docker镜像构建定义
│   │
│   ├── ontology-service/               # 本体管理服务 - 管理RDF/OWL本体模型
│   │   ├── src/main/java/              # Java源码根目录
│   │   │   └── com.emailagent.ontology/ # 本体服务包空间
│   │   │       ├── domain/             # 领域层 - 本体核心业务逻辑
│   │   │       │   ├── model/          # 本体模型 - 本体数据结构
│   │   │       │   │   ├── Ontology.java          # 本体实体 - 完整本体定义
│   │   │       │   │   ├── OntologyClass.java     # 本体类 - 概念分类定义
│   │   │       │   │   ├── OntologyProperty.java  # 本体属性 - 关系和数据属性
│   │   │       │   │   └── OntologyIndividual.java # 本体实例 - 具体实例数据
│   │   │       │   └── service/       # 本体推理服务 - 逻辑推理引擎
│   │   │       │       └── OntologyInferenceService.java # 本体推理实现 - 基于OWL推理
│   │   │       └── ...                # 其他标准DDD层结构
│   │   └── pom.xml                    # Maven配置 - 本体服务依赖管理
│   │
│   ├── visualization-service/          # 可视化服务 - 知识图谱图形化展示
│   │   ├── src/main/java/              # Java源码根目录
│   │   │   └── com.emailagent.visualization/ # 可视化服务包空间
│   │   │       ├── domain/             # 领域层 - 可视化业务逻辑
│   │   │       │   ├── model/          # 可视化模型 - 图形数据结构
│   │   │       │   │   ├── Visualization.java # 可视化实体 - 图表配置信息
│   │   │       │   │   ├── GraphLayout.java   # 图布局实体 - 节点位置算法
│   │   │       │   │   └── ChartConfig.java   # 图表配置 - D3.js图表参数
│   │   │       │   └── service/       # 可视化服务 - 渲染和布局算法
│   │   │       │       ├── D3LayoutService.java      # D3布局服务 - 力导向布局算法
│   │   │       │       └── GraphRenderingService.java # 图渲染服务 - SVG/Canvas渲染
│   │   │       └── ...                # 其他标准DDD层结构
│   │   └── pom.xml                    # Maven配置 - 可视化服务依赖管理
│   │
│   ├── data-import-service/            # 数据导入服务 - 多源数据ETL处理
│   │   ├── src/main/java/              # Java源码根目录
│   │   │   └── com.emailagent.datimport/ # 数据导入包空间
│   │   │       ├── domain/             # 领域层 - 导入业务逻辑
│   │   │       │   ├── model/          # 导入模型 - ETL数据结构
│   │   │       │   │   ├── ImportJob.java    # 导入任务 - ETL作业定义
│   │   │       │   │   ├── ImportTask.java   # 导入子任务 - 分片处理单元
│   │   │       │   │   └── DataSource.java   # 数据源 - 连接配置信息
│   │   │       │   └── service/       # 导入服务 - 各种格式解析器
│   │   │       │       ├── CSVParserService.java   # CSV解析服务 - 结构化数据处理
│   │   │       │       ├── JSONParserService.java  # JSON解析服务 - 半结构化数据处理
│   │   │       │       └── BatchImportService.java # 批量导入服务 - 大数据量优化
│   │   │       └── ...                # 其他标准DDD层结构
│   │   └── pom.xml                    # Maven配置 - 数据导入服务依赖管理
│   │
│   ├── email-processing-service/       # 邮件处理服务 - 邮件内容解析和实体提取
│   │   ├── src/main/java/              # Java源码根目录
│   │   │   └── com.emailagent.email/   # 邮件处理包空间
│   │   │       ├── domain/             # 领域层 - 邮件业务逻辑
│   │   │       │   ├── model/          # 邮件模型 - 邮件数据结构
│   │   │       │   │   ├── Email.java            # 邮件实体 - 完整邮件信息
│   │   │       │   │   ├── EmailAttachment.java  # 邮件附件 - 附件元数据
│   │   │       │   │   └── EmailMetadata.java    # 邮件元数据 - 发送接收信息
│   │   │       │   └── service/       # 邮件处理服务 - 智能分析服务
│   │   │       │       ├── EmailParserService.java      # 邮件解析服务 - 结构化解析
│   │   │       │       ├── EntityExtractionService.java # 实体提取服务 - NLP处理
│   │   │       │       └── EmailClassificationService.java # 邮件分类服务 - 智能分类
│   │   │       └── ...                # 其他标准DDD层结构
│   │   └── pom.xml                    # Maven配置 - 邮件处理服务依赖管理
│   │
│   ├── user-management-service/        # 用户管理服务 - 统一身份认证和权限管理
│   │   ├── src/main/java/              # Java源码根目录
│   │   │   └── com.emailagent.user/    # 用户管理包空间
│   │   │       ├── domain/             # 领域层 - 用户业务逻辑
│   │   │       │   ├── model/          # 用户模型 - 身份权限数据结构
│   │   │       │   │   ├── User.java      # 用户实体 - 用户基本信息
│   │   │       │   │   ├── Role.java      # 角色实体 - RBAC角色定义
│   │   │       │   │   └── Permission.java # 权限实体 - 细粒度权限控制
│   │   │       │   └── service/       # 用户服务 - 认证授权实现
│   │   │       │       ├── UserAuthService.java    # 用户认证服务 - JWT/OAuth2实现
│   │   │       │       └── UserProfileService.java # 用户资料服务 - 个人信息管理
│   │   │       └── ...                # 其他标准DDD层结构
│   │   └── pom.xml                    # Maven配置 - 用户管理服务依赖管理
│   │
│   ├── notification-service/           # 通知服务 - 多渠道消息推送
│   │   ├── src/main/java/              # Java源码根目录
│   │   │   └── com.emailagent.notification/ # 通知服务包空间
│   │   │       ├── domain/             # 领域层 - 通知业务逻辑
│   │   │       │   ├── model/          # 通知模型 - 消息数据结构
│   │   │       │   │   ├── Notification.java         # 通知实体 - 消息内容模板
│   │   │       │   │   ├── NotificationTemplate.java # 通知模板 - 可复用模板
│   │   │       │   │   └── NotificationChannel.java  # 通知渠道 - 邮件/短信/WebSocket
│   │   │       │   └── service/       # 通知服务 - 多渠道发送实现
│   │   │       │       ├── EmailNotificationService.java    # 邮件通知服务 - SMTP集成
│   │   │       │       ├── WebSocketNotificationService.java # 实时推送服务 - WebSocket
│   │   │       │       └── PushNotificationService.java     # 推送通知服务 - 移动端推送
│   │   │       └── ...                # 其他标准DDD层结构
│   │   └── pom.xml                    # Maven配置 - 通知服务依赖管理
│   │
│   └── audit-service/                  # 审计服务 - 操作日志和行为追踪
│       ├── src/main/java/              # Java源码根目录
│       │   └── com.emailagent.audit/   # 审计服务包空间
│       │       ├── domain/             # 领域层 - 审计业务逻辑
│       │       │   ├── model/          # 审计模型 - 日志数据结构
│       │       │   │   ├── AuditLog.java   # 审计日志 - 操作记录实体
│       │       │   │   └── AuditEvent.java # 审计事件 - 行为追踪实体
│       │       │   └── service/       # 审计服务 - 日志分析实现
│       │       │       └── AuditService.java # 审计服务实现 - 日志存储查询
│       │       └── ...                # 其他标准DDD层结构
│       └── pom.xml                    # Maven配置 - 审计服务依赖管理
│
├── infrastructure/                     # 基础设施服务 - 微服务治理组件
│   ├── config-server/                  # 配置中心 - Spring Cloud Config集中配置
│   │   ├── src/main/java/              # Java源码根目录
│   │   │   └── com.emailagent.config/  # 配置服务器包空间
│   │   │       └── ConfigServerApplication.java # 配置服务器启动类 - 集中配置管理
│   │   ├── src/main/resources/         # 资源配置目录
│   │   │   ├── application.yml         # 配置服务器设置 - Git仓库配置
│   │   │   └── config/                 # 服务配置目录 - 各微服务配置文件
│   │   │       ├── knowledge-graph-service.yml # 知识图谱服务配置 - 图数据库连接
│   │   │       ├── ontology-service.yml        # 本体服务配置 - OWL推理参数
│   │   │       └── ...                         # 其他服务配置文件
│   │   └── pom.xml                    # Maven配置 - 配置中心依赖管理
│   │
│   ├── api-gateway/                    # API网关 - Spring Cloud Gateway统一入口
│   │   ├── src/main/java/              # Java源码根目录
│   │   │   └── com.emailagent.gateway/ # 网关服务包空间
│   │   │       ├── GatewayApplication.java # 网关启动类 - 统一请求入口
│   │   │       ├── config/             # 网关配置 - 路由和安全策略
│   │   │       │   ├── RouteConfig.java        # 路由配置 - 服务发现和负载均衡
│   │   │       │   ├── SecurityConfig.java     # 安全配置 - JWT验证和OAuth2
│   │   │       │   └── RateLimitConfig.java    # 限流配置 - 流量控制和熔断
│   │   │       └── filter/             # 网关过滤器 - 横切关注点
│   │   │           ├── AuthenticationFilter.java # 认证过滤器 - 统一身份验证
│   │   │           ├── LoggingFilter.java        # 日志过滤器 - 请求响应记录
│   │   │           └── CircuitBreakerFilter.java # 熔断过滤器 - 服务降级保护
│   │   ├── src/main/resources/         # 资源配置目录
│   │   │   └── application.yml         # 网关配置文件 - 路由规则和端口设置
│   │   └── pom.xml                    # Maven配置 - API网关依赖管理
│   │
│   ├── service-discovery/              # 服务发现 - Eureka注册中心
│   │   ├── src/main/java/              # Java源码根目录
│   │   │   └── com.emailagent.discovery/ # 服务发现包空间
│   │   │       └── DiscoveryServerApplication.java # 服务发现启动类 - Eureka服务器
│   │   └── pom.xml                    # Maven配置 - 服务发现依赖管理
│   │
│   ├── monitoring/                   # 监控服务 - 可观测性技术栈
│   │   ├── prometheus/               # 指标收集 - 时序数据库和告警
│   │   ├── grafana/                  # 可视化监控 - 仪表板和图表
│   │   ├── jaeger/                   # 链路追踪 - 分布式追踪系统
│   │   └── elk/                      # 日志聚合 - Elasticsearch+Logstash+Kibana
│   │
│   └── message-broker/               # 消息中间件 - 异步通信和解耦
│       ├── kafka/                    # Kafka配置 - 高吞吐量消息队列
│       └── rabbitmq/                 # RabbitMQ配置 - 可靠消息传递
│
├── shared/                           # 共享模块 - 代码复用和标准化
│   ├── common-lib/                   # 公共库 - 通用工具类和模型
│   │   ├── src/main/java/              # Java源码根目录
│   │   │   └── com.emailagent.common/  # 公共库包空间
│   │   │       ├── model/              # 公共模型 - 跨服务数据结构
│   │   │       │   ├── BaseEntity.java     # 基础实体 - 通用字段如ID、时间戳
│   │   │       │   ├── ApiResponse.java    # API响应 - 统一返回格式
│   │   │       │   └── ErrorResponse.java  # 错误响应 - 异常信息封装
│   │   │       ├── exception/          # 异常处理 - 全局异常定义
│   │   │       │   ├── BusinessException.java     # 业务异常 - 可预期的业务错误
│   │   │       │   └── GlobalExceptionHandler.java # 全局异常处理器 - 统一异常处理
│   │   │       ├── util/               # 工具类 - 常用工具方法
│   │   │       │   ├── JsonUtil.java      # JSON工具 - Jackson封装
│   │   │       │   ├── ValidationUtil.java # 验证工具 - Bean Validation封装
│   │   │       │   └── SecurityUtil.java  # 安全工具 - 加密解密工具
│   │   │       └── constant/           # 常量定义 - 系统级常量
│   │   │           ├── ServiceConstants.java # 服务常量 - 服务名和版本
│   │   │           └── ErrorCode.java        # 错误码 - 标准化错误代码
│   │   └── pom.xml                    # Maven配置 - 公共库依赖管理
│   │
│   ├── security-lib/                 # 安全库 - 认证授权统一实现
│   │   ├── src/main/java/              # Java源码根目录
│   │   │   └── com.emailagent.security/ # 安全库包空间
│   │   │       ├── config/             # 安全配置 - Spring Security集成
│   │   │       │   ├── JwtConfig.java      # JWT配置 - Token签名和有效期
│   │   │       │   └── SecurityConfig.java # 安全配置 - 安全策略定义
│   │   │       ├── filter/             # 安全过滤器 - 请求过滤和验证
│   │   │       │   └── JwtAuthenticationFilter.java # JWT认证过滤器 - Token解析验证
│   │   │       └── util/               # 安全工具 - JWT操作工具
│   │   │           └── JwtUtil.java      # JWT工具类 - Token生成和解析
│   │   └── pom.xml                    # Maven配置 - 安全库依赖管理
│   │
│   └── database-lib/                 # 数据库库 - 数据访问统一封装
│       ├── src/main/java/              # Java源码根目录
│       │   └── com.emailagent.database/ # 数据库库包空间
│       │       ├── config/             # 数据库配置 - 多数据源配置
│       │       │   ├── JanusGraphConfig.java # Janus图数据库配置 - 图连接池
│       │       │   ├── CassandraConfig.java # Cassandra配置 - NoSQL连接
│       │       │   └── RedisConfig.java      # Redis配置 - 缓存和会话存储
│       │       └── util/               # 数据库工具 - 查询和缓存工具
│       │           ├── GraphTraversalUtil.java # 图遍历工具 - Gremlin查询封装
│       │           └── CacheUtil.java          # 缓存工具 - Redis操作封装
│       └── pom.xml                    # Maven配置 - 数据库库依赖管理
│
├── deployment/                       # 部署配置 - 容器化和编排配置
│   ├── docker/                       # Docker配置 - 容器化部署
│   │   ├── docker-compose.yml        # 开发环境 - 本地开发一键启动
│   │   ├── docker-compose.prod.yml   # 生产环境 - 生产级容器编排
│   │   └── Dockerfile.*              # 各服务镜像 - 微服务容器定义
│   │
│   ├── kubernetes/                   # Kubernetes配置 - 云原生编排
│   │   ├── base/                     # 基础配置 - 命名空间和全局配置
│   │   │   ├── namespace.yaml        # 命名空间 - 逻辑隔离环境
│   │   │   ├── configmap.yaml        # 配置映射 - 环境变量配置
│   │   │   └── secret.yaml           # 密钥配置 - 敏感信息安全存储
│   │   ├── services/                 # 各服务配置 - 微服务K8s定义
│   │   │   ├── knowledge-graph-service/ # 知识图谱服务K8s配置
│   │   │   │   ├── deployment.yaml   # 部署配置 - Pod副本和资源限制
│   │   │   │   ├── service.yaml      # 服务配置 - 集群内服务发现
│   │   │   │   ├── configmap.yaml    # 配置映射 - 应用配置外部化
│   │   │   │   └── ingress.yaml      # 入口配置 - 外部访问路由
│   │   │   ├── ontology-service/     # 本体服务K8s配置
│   │   │   └── ...                   # 其他服务K8s配置
│   │   ├── infrastructure/           # 基础设施配置 - 中间件K8s定义
│   │   │   ├── janusgraph/           # Janus图数据库K8s配置
│   │   │   │   ├── janusgraph-deployment.yaml # Janus部署 - 图数据库实例
│   │   │   │   ├── janusgraph-service.yaml    # Janus服务 - 图数据库访问
│   │   │   │   └── janusgraph-configmap.yaml # Janus配置 - 图数据库参数
│   │   │   ├── cassandra/            # Cassandra K8s配置
│   │   │   │   ├── cassandra-statefulset.yaml # Cassandra集群 - 有状态服务
│   │   │   │   ├── cassandra-service.yaml    # Cassandra服务 - 节点发现
│   │   │   │   └── cassandra-configmap.yaml  # Cassandra配置 - 集群参数
│   │   │   ├── elasticsearch/        # Elasticsearch K8s配置
│   │   │   └── redis/                # Redis K8s配置
│   │   └── helm/                     # Helm Charts - K8s包管理
│   │       ├── email-agent/          # 主Chart - 完整应用打包
│   │       └── charts/               # 子Charts - 微服务独立打包
│   │
│   ├── terraform/                    # 基础设施即代码 - 云资源自动化
│   │   ├── environments/             # 环境配置 - 多环境管理
│   │   │   ├── dev/                  # 开发环境 - 开发资源配置
│   │   │   ├── staging/              # 预发布环境 - 测试资源配置
│   │   │   └── prod/                 # 生产环境 - 生产高可用配置
│   │   ├── modules/                  # 模块定义 - 可复用基础设施
│   │   │   ├── kubernetes/           # K8s模块 - 集群自动化创建
│   │   │   ├── database/             # 数据库模块 - 托管数据库实例
│   │   │   └── networking/           # 网络模块 - VPC和安全组
│   │   └── main.tf                   # 主配置文件 - Terraform入口点
│   │
│   └── scripts/                      # 部署脚本 - 自动化运维
│       ├── build.sh                  # 构建脚本 - 一键编译打包
│       ├── deploy.sh                 # 部署脚本 - 环境部署自动化
│       ├── rollback.sh               # 回滚脚本 - 快速故障恢复
│       └── health-check.sh           # 健康检查脚本 - 服务状态监控
│
├── docs/                             # 项目文档 - 完整技术文档
│   ├── api/                          # API文档 - 接口规范和测试
│   │   ├── openapi.yaml              # OpenAPI规范 - 标准API定义
│   │   ├── postman/                  # Postman集合 - API测试用例
│   │   └── graphiql/                 # GraphQL文档 - 交互式查询界面
│   ├── architecture/                 # 架构文档 - 系统设计说明
│   │   ├── system-overview.md        # 系统概览 - 整体架构描述
│   │   ├── service-specs/            # 服务规范 - 微服务详细设计
│   │   └── data-model/               # 数据模型文档 - ER图和Schema
│   ├── deployment/                   # 部署文档 - 运维指南
│   │   ├── deployment-guide.md       # 部署指南 - 分步部署说明
│   │   ├── troubleshooting.md        # 故障排查 - 常见问题解决
│   │   └── runbook.md                # 运维手册 - 日常运维操作
│   ├── development/                  # 开发文档 - 开发环境设置
│   │   ├── setup-guide.md            # 环境搭建 - 开发环境配置
│   │   ├── coding-standards.md       # 编码规范 - 代码风格指南
│   │   └── contribution-guide.md     # 贡献指南 - 开源贡献流程
│   └── security/                     # 安全文档 - 安全最佳实践
│       ├── security-guide.md         # 安全指南 - 安全开发规范
│       └── compliance-checklist.md   # 合规检查 - 安全审计清单
│
├── tests/                            # 测试目录 - 全面测试策略
│   ├── e2e/                          # 端到端测试 - 完整业务流程验证
│   ├── performance/                  # 性能测试 - 负载和压力测试
│   ├── security/                     # 安全测试 - 渗透测试和漏洞扫描
│   └── chaos/                        # 混沌工程测试 - 系统韧性验证
│
├── tools/                            # 开发工具 - 提升开发效率
│   ├── code-generator/               # 代码生成器 - 自动化CRUD代码生成
│   ├── db-migration/                 # 数据库迁移工具 - 版本化Schema管理
│   └── monitoring-dashboard/         # 监控面板 - 自定义Grafana仪表板
│
├── .github/                          # GitHub配置 - 开源项目协作
│   ├── workflows/                    # CI/CD工作流 - 自动化流水线
│   │   ├── build.yml                 # 构建工作流 - 代码编译和测试
│   │   ├── test.yml                  # 测试工作流 - 自动化测试执行
│   │   ├── security-scan.yml         # 安全扫描工作流 - 漏洞检测
│   │   └── deploy.yml                # 部署工作流 - 自动部署到环境
│   ├── ISSUE_TEMPLATE/               # Issue模板 - 标准化问题报告
│   └── PULL_REQUEST_TEMPLATE.md        # PR模板 - 代码审查清单
│
├── pom.xml                           # 根Maven配置 - 多模块聚合构建
├── docker-compose.yml                # 开发环境 - 一键本地启动
├── README.md                         # 项目说明 - 项目介绍和快速开始
├── CONTRIBUTING.md                   # 贡献指南 - 开源贡献规范
├── LICENSE                           # 许可证 - Apache 2.0开源协议
└── .gitignore                        # Git忽略文件 - 版本控制忽略规则
```


## 3. 核心业务服务设计

### 3.1 知识图谱服务 (Knowledge Graph Service)

#### 3.1.1 服务概述
- **服务名称**: knowledge-graph-service
- **端口**: 8081
- **主要职责**: 负责知识图谱的创建、编辑、查询和分析
- **技术栈**: Spring Boot 3.2 + JanusGraph 1.0 + Apache TinkerPop Gremlin

#### 3.1.2 功能特性
| 功能模块 | 具体功能 | API端点 |
|---------|----------|---------|
| **图谱管理** | 创建、查询、更新、删除图谱 | POST /api/v1/graphs |
| **节点管理** | 节点的CRUD操作 | POST /api/v1/graphs/{id}/nodes |
| **关系管理** | 关系的CRUD操作 | POST /api/v1/graphs/{id}/edges |
| **图查询** | Gremlin查询、图遍历 | POST /api/v1/graphs/{id}/query |
| **图算法** | 最短路径、中心性分析 | POST /api/v1/graphs/{id}/algorithms/{type} |
| **实时通知** | 图谱变更WebSocket推送 | /ws/graph-updates |

#### 3.1.3 数据模型
```java
// 图节点实体
@Vertex("GraphNode")
public class GraphNode {
    @Id @GeneratedValue private Long id;
    @Property("name") private String name;
    @Property("type") private String type;
    @Property("properties") private Map<String, Object> properties;
    @Property("x") private Double x;
    @Property("y") private Double y;
    @Property("created_at") private LocalDateTime createdAt;
    @Property("updated_at") private LocalDateTime updatedAt;
}

// 图关系实体
@Edge("RELATES_TO")
public class GraphEdge {
    @Id @GeneratedValue private Long id;
    @InVertex private GraphNode inVertex;
    @OutVertex private GraphNode outVertex;
    @Property("type") private String type;
    @Property("properties") private Map<String, Object> properties;
    @Property("created_at") private LocalDateTime createdAt;
}

// 知识图谱聚合根
@Vertex("KnowledgeGraph")
public class KnowledgeGraph {
    @Id @GeneratedValue private Long id;
    @Property("name") private String name;
    @Property("description") private String description;
    @Property("schema") private GraphSchema schema;
    @Property("created_at") private LocalDateTime createdAt;
    @Property("updated_at") private LocalDateTime updatedAt;
}
```

#### 3.1.4 技术架构
- **图数据库**: JanusGraph 1.0.x (TinkerPop 3.7兼容)
- **存储后端**: 
  - Apache Cassandra 4.1 (主存储，支持水平扩展)
  - Elasticsearch 8.11 (全文索引和二级索引)
  - Redis 7.x (查询结果缓存)
- **查询语言**: Gremlin (TinkerPop标准)
- **图计算**: TinkerPop GraphComputer + Apache Spark
- **事务管理**: JanusGraph分布式事务

### 3.2 本体管理服务 (Ontology Management Service)

#### 3.2.1 服务概述
- **服务名称**: ontology-service
- **端口**: 8082
- **主要职责**: 负责本体模型的设计、验证、版本管理
- **技术栈**: Spring Boot 3.2 + PostgreSQL 15 + Jena/OWL API

#### 3.2.2 功能特性
| 功能模块 | 具体功能 | API端点 |
|---------|----------|---------|
| **本体管理** | 创建、查询、更新、删除本体 | POST /api/v1/ontologies |
| **类管理** | 本体类的CRUD操作 | POST /api/v1/ontologies/{id}/classes |
| **属性管理** | 数据属性和对象属性管理 | POST /api/v1/ontologies/{id}/properties |
| **验证检查** | 本体一致性验证 | POST /api/v1/ontologies/{id}/validate |
| **导入导出** | OWL/RDF格式支持 | GET /api/v1/ontologies/{id}/export |
| **版本管理** | 本体版本控制 | GET /api/v1/ontologies/{id}/versions |

#### 3.2.3 数据模型
```java
// 本体实体
@Entity @Table(name = "ontologies")
public class Ontology {
    @Id private String id;
    private String name;
    private String namespace;
    private String description;
    @Enumerated(EnumType.STRING) private OntologyStatus status;
    private String version;
    @Column(columnDefinition = "TEXT") private String content; // OWL/RDF
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
}

// 本体类实体
@Entity @Table(name = "ontology_classes")
public class OntologyClass {
    @Id private String id;
    private String name;
    private String parentClass;
    @ElementCollection private Map<String, String> properties;
    private String ontologyId;
}

// 本体属性实体
@Entity @Table(name = "ontology_properties")
public class OntologyProperty {
    @Id private String id;
    private String name;
    @Enumerated(EnumType.STRING) private PropertyType type;
    private String domain;
    private String range;
    private String ontologyId;
}
```

### 3.3 可视化服务 (Visualization Service)

#### 3.3.1 服务概述
- **服务名称**: visualization-service
- **端口**: 8083
- **主要职责**: 负责知识图谱的可视化渲染和交互
- **技术栈**: Spring Boot 3.2 + WebSocket + D3.js/Canvas

#### 3.3.2 功能特性
| 功能模块 | 具体功能 | API端点 |
|---------|----------|---------|
| **布局算法** | 力导向、层次、圆形布局 | POST /api/v1/visualization/layout |
| **图表渲染** | 节点和边的可视化渲染 | GET /api/v1/visualization/graphs/{id} |
| **交互操作** | 缩放、拖拽、选择 | WebSocket实时交互 |
| **导出功能** | PNG/SVG/PDF格式导出 | POST /api/v1/visualization/export |
| **实时更新** | 图谱变更实时推送 | /ws/visualization |

#### 3.3.3 布局算法实现
```java
// 布局算法接口
public interface LayoutAlgorithm {
    LayoutResult calculateLayout(GraphData graph, LayoutOptions options);
}

// 力导向布局
@Component
public class ForceDirectedLayout implements LayoutAlgorithm {
    @Override
    public LayoutResult calculateLayout(GraphData graph, LayoutOptions options) {
        // 基于D3.js力导向算法实现
        // 支持节点权重、边权重、重力因子等参数
    }
}

// 层次布局
@Component
public class HierarchicalLayout implements LayoutAlgorithm {
    @Override
    public LayoutResult calculateLayout(GraphData graph, LayoutOptions options) {
        // 基于图论层次算法
        // 支持树形结构、DAG结构
    }
}
```

### 3.4 数据导入服务 (Data Import Service)

#### 3.4.1 服务概述
- **服务名称**: data-import-service
- **端口**: 8084
- **主要职责**: 负责多格式数据的导入、清洗、转换
- **技术栈**: Spring Boot 3.2 + Apache Camel + Apache POI

#### 3.4.2 支持格式
| 文件格式 | 支持程度 | 处理策略 |
|---------|----------|----------|
| **CSV** | 完全支持 | Apache Commons CSV |
| **JSON** | 完全支持 | Jackson/Gson |
| **Excel** | 完全支持 | Apache POI |
| **RDF/OWL** | 完全支持 | Apache Jena |
| **XML** | 部分支持 | JAXB/SAX解析 |

#### 3.4.3 功能特性
| 功能模块 | 具体功能 | API端点 |
|---------|----------|---------|
| **任务管理** | 导入任务创建、查询、取消 | POST /api/v1/import/tasks |
| **文件上传** | 多文件上传、分片上传 | POST /api/v1/import/upload |
| **数据预览** | 上传文件预览和验证 | GET /api/v1/import/preview/{id} |
| **数据清洗** | 格式验证、去重、转换 | POST /api/v1/import/clean/{id} |
| **进度跟踪** | 实时导入进度查询 | GET /api/v1/import/progress/{id} |

#### 3.4.4 数据模型
```java
// 导入任务实体
@Entity @Table(name = "import_tasks")
public class ImportTask {
    @Id private String id;
    private String filename;
    private String graphId;
    @Enumerated(EnumType.STRING) private ImportStatus status;
    private Long totalRecords;
    private Long processedRecords;
    private Long errorRecords;
    private String errorMessage;
    private LocalDateTime createdAt;
    private LocalDateTime completedAt;
}

// 数据映射配置
@Entity @Table(name = "import_mappings")
public class ImportMapping {
    @Id private String id;
    private String taskId;
    private String sourceField;
    private String targetField;
    private String transformationRule;
    private Boolean isRequired;
}
```

### 3.5 邮件处理服务 (Email Processing Service)

#### 3.5.1 服务概述
- **服务名称**: email-processing-service
- **端口**: 8085
- **主要职责**: 负责邮件接收、解析、实体提取、自动更新图谱
- **技术栈**: Spring Boot 3.2 + JavaMail + Apache OpenNLP

#### 3.5.2 功能特性
| 功能模块 | 具体功能 | API端点 |
|---------|----------|---------|
| **邮箱配置** | IMAP/POP3邮箱配置 | POST /api/v1/email/config |
| **邮件接收** | 定时拉取邮件 | GET /api/v1/email/fetch |
| **内容解析** | 邮件正文和附件解析 | POST /api/v1/email/parse |
| **实体提取** | NER实体识别和关系抽取 | POST /api/v1/email/extract |
| **自动更新** | 自动更新知识图谱 | POST /api/v1/email/update-graph |

#### 3.5.3 技术实现
```java
// 邮件接收器
@Component
public class EmailReceiver {
    @Scheduled(fixedDelay = 300000) // 5分钟检查一次
    public void checkEmails() {
        // 连接邮件服务器
        // 获取新邮件
        // 解析邮件内容
        // 提取实体和关系
        // 更新知识图谱
    }
}

// 实体提取器
@Component
public class EntityExtractor {
    public List<ExtractedEntity> extractEntities(String text) {
        // 使用OpenNLP或Stanford NLP
        // 命名实体识别 (NER)
        // 关系抽取
        // 置信度计算
    }
}
```

### 3.6 用户管理服务 (User Management Service)

#### 3.6.1 服务概述
- **服务名称**: user-management-service
- **端口**: 8086
- **主要职责**: 负责用户注册、认证、授权、权限管理
- **技术栈**: Spring Boot 3.2 + Spring Security + JWT

#### 3.6.2 功能特性
| 功能模块 | 具体功能 | API端点 |
|---------|----------|---------|
| **用户管理** | 注册、登录、密码重置 | POST /api/v1/auth/register |
| **认证授权** | JWT Token生成和验证 | POST /api/v1/auth/login |
| **权限管理** | RBAC角色权限控制 | GET /api/v1/users/permissions |
| **用户配置** | 个人资料、偏好设置 | PUT /api/v1/users/profile |
| **审计日志** | 用户操作记录 | GET /api/v1/users/audit-log |

## 4. 数据架构设计

### 4.1 数据存储策略

#### 4.1.1 图数据存储 (JanusGraph架构)
- **图数据库**: JanusGraph 1.x (TinkerPop兼容)
- **后端存储**: 
  - **主存储**: Apache Cassandra (分布式存储，支持水平扩展)
  - **索引存储**: Elasticsearch (全文索引 + 二级索引)
  - **缓存层**: Redis (查询结果缓存 + 图缓存)
- **存储后端可选**: HBase (替代Cassandra) 或 ScyllaDB
- **备份策略**: 
  - Cassandra快照备份到S3
  - Elasticsearch快照备份
  - JanusGraph配置备份

#### 4.1.2 配置数据存储
- **配置中心**: Spring Cloud Config Server + Git
- **动态配置**: Redis + 配置刷新事件
- **本地缓存**: 每个服务本地配置文件

#### 4.1.3 文件存储
- **对象存储**: MinIO (S3兼容)
- **CDN集成**: 可选阿里云OSS/AWS S3
- **文件元数据**: PostgreSQL

### 4.2 数据一致性策略

#### 4.2.1 最终一致性
- **事件溯源**: 所有变更通过事件总线传播
- **CQRS模式**: 读写分离，读模型最终一致
- **补偿事务**: Saga模式处理分布式事务

#### 4.2.2 缓存策略
- **多级缓存**: Redis + 本地缓存 + CDN
- **缓存失效**: 基于事件的主动失效
- **缓存穿透**: BloomFilter防护

## 5. 部署架构

### 5.1 容器化部署

#### 5.1.1 Docker镜像设计
```dockerfile
# 知识图谱服务Dockerfile
FROM openjdk:17-jre-slim

WORKDIR /app

COPY target/knowledge-graph-service-*.jar app.jar

ENV JAVA_OPTS="-Xmx2g -Xms1g"

EXPOSE 8080

HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
  CMD curl -f http://localhost:8080/actuator/health || exit 1

ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar app.jar"]
```

#### 5.1.2 Docker Compose开发环境 (JanusGraph)
```yaml
version: '3.8'
services:
  # 知识图谱服务
  knowledge-graph-service:
    image: knowledge-graph-service:latest
    ports:
      - "8081:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - JANUSGRAPH_HOST=janusgraph
      - JANUSGRAPH_PORT=8182
      - CASSANDRA_HOST=cassandra
      - ELASTICSEARCH_HOST=elasticsearch
      - REDIS_HOST=redis
    depends_on:
      - janusgraph
      - cassandra
      - elasticsearch
      - redis
    networks:
      - kg-network

  # JanusGraph服务器
  janusgraph:
    image: janusgraph/janusgraph:latest
    ports:
      - "8182:8182"
    environment:
      - janusgraph.storage.backend=cql
      - janusgraph.storage.hostname=cassandra
      - janusgraph.index.search.backend=elasticsearch
      - janusgraph.index.search.hostname=elasticsearch
    depends_on:
      - cassandra
      - elasticsearch
    networks:
      - kg-network

  # Cassandra存储后端
  cassandra:
    image: cassandra:4.1
    ports:
      - "9042:9042"
    environment:
      - CASSANDRA_CLUSTER_NAME=janusgraph-cluster
      - CASSANDRA_DC=datacenter1
    volumes:
      - cassandra_data:/var/lib/cassandra
    networks:
      - kg-network

  # Elasticsearch索引后端
  elasticsearch:
    image: elasticsearch:8.11.0
    ports:
      - "9200:9200"
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
      - ES_JAVA_OPTS=-Xms1g -Xmx1g
    volumes:
      - es_data:/usr/share/elasticsearch/data
    networks:
      - kg-network

  # Redis缓存
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    networks:
      - kg-network

networks:
  kg-network:
    driver: bridge

volumes:
  cassandra_data:
  es_data:
```

### 5.2 Kubernetes生产部署

#### 5.2.1 Helm Chart结构
```
knowledge-platform/
├── Chart.yaml
├── values.yaml
├── templates/
│   ├── deployment.yaml
│   ├── service.yaml
│   ├── configmap.yaml
│   ├── ingress.yaml
│   └── hpa.yaml
└── charts/
    ├── neo4j/
    ├── redis/
    └── elasticsearch/
```

#### 5.2.2 资源分配 (JanusGraph架构)
| 服务 | CPU | 内存 | 存储 | 副本数 | 说明 |
|------|-----|------|------|--------|------|
| 知识图谱服务 | 2核 | 4GB | 10GB | 2 | 业务服务 |
| 本体管理服务 | 1核 | 2GB | 5GB | 2 | 业务服务 |
| 可视化服务 | 1核 | 2GB | 5GB | 2 | 业务服务 |
| 数据导入服务 | 2核 | 4GB | 20GB | 1 | 业务服务 |
| 邮件处理服务 | 1核 | 2GB | 5GB | 1 | 业务服务 |
| JanusGraph | 2核 | 4GB | 10GB | 2 | 图数据库服务 |
| Cassandra | 4核 | 8GB | 100GB | 3 | 分布式存储后端 |
| Elasticsearch | 2核 | 4GB | 50GB | 3 | 索引后端 |
| Redis | 0.5核 | 1GB | 5GB | 1 | 缓存层 |
```

### 5.3 监控与运维

#### 5.3.1 监控体系
- **应用监控**: Micrometer + Prometheus
- **基础设施**: Node Exporter + cAdvisor
- **日志收集**: ELK Stack (Elasticsearch + Logstash + Kibana)
- **链路追踪**: Jaeger / Zipkin
- **告警**: Prometheus AlertManager

#### 5.3.2 健康检查
```yaml
# Kubernetes健康检查配置
livenessProbe:
  httpGet:
    path: /actuator/health/liveness
    port: 8080
  initialDelaySeconds: 60
  periodSeconds: 30

readinessProbe:
  httpGet:
    path: /actuator/health/readiness
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 10
```

## 6. 安全设计

### 6.1 认证授权
- **JWT Token**: 基于Spring Security的JWT认证
- **RBAC**: 基于角色的权限控制
- **API Key**: 第三方集成API密钥管理
- **OAuth2**: 支持第三方登录集成

### 6.2 数据安全
- **传输加密**: HTTPS/TLS 1.3
- **存储加密**: 数据库透明数据加密(TDE)
- **敏感数据**: 字段级加密(AES-256)
- **密钥管理**: HashiCorp Vault

### 6.3 网络安全
- **网络隔离**: Kubernetes NetworkPolicy
- **API网关**: 统一入口，WAF防护
- **服务网格**: Istio mTLS
- **DDoS防护**: 云服务商防护

## 7. 性能优化

### 7.1 缓存策略
- **多级缓存**: L1(应用内存) + L2(Redis) + L3(CDN)
- **缓存预热**: 启动时加载热点数据
- **缓存穿透**: BloomFilter + 空值缓存
- **缓存雪崩**: 随机过期时间 + 降级策略

### 7.2 数据库优化
- **读写分离**: 主从复制，读操作路由到从库
- **分片策略**: 按业务域水平分片
- **索引优化**: 复合索引 + 覆盖索引
- **查询优化**: Cypher查询优化 + 预编译语句

### 7.3 水平扩展
- **无状态服务**: 所有业务服务无状态设计
- **数据库扩展**: Neo4j集群模式 + 读写分离
- **缓存集群**: Redis Cluster模式
- **负载均衡**: Nginx + Kubernetes Service

## 8. 测试策略

### 8.1 测试金字塔
```
        /\
       /  \
      / UI \
     /  测试  \
    /─────────\
   /   集成    \
  /    测试     \
 /───────────────\
/     单元测试     \
───────────────────
```

### 8.2 测试类型
- **单元测试**: JUnit 5 + Mockito (覆盖率>80%)
- **集成测试**: Spring Boot Test + Testcontainers
- **契约测试**: Spring Cloud Contract
- **端到端测试**: Cypress + Selenium
- **性能测试**: JMeter + Gatling

### 8.3 测试环境
- **开发环境**: Docker Compose本地开发
- **测试环境**: Kubernetes测试集群
- **预生产环境**: 与生产环境相同配置
- **混沌工程**: Chaos Monkey for Spring Boot

## 9. 迁移策略

### 9.1 从Python单体到Java微服务

#### 9.1.1 迁移阶段
1. **阶段1**: 数据层迁移 (Neo4j替换NetworkX)
2. **阶段2**: 服务拆分 (按业务域逐步拆分)
3. **阶段3**: 前端重构 (React替换Dash)
4. **阶段4**: 基础设施迁移 (K8s部署)

#### 9.1.2 数据迁移
- **数据导出**: 从Python JSON格式导出
- **数据转换**: 转换为Neo4j导入格式
- **数据验证**: 验证数据完整性和一致性
- **增量同步**: 迁移期间的双写策略

#### 9.1.3 兼容性保证
- **API兼容**: 保持RESTful API兼容
- **数据格式**: 保持JSON数据格式一致
- **功能回退**: 支持快速回滚到Python版本

### 9.2 风险缓解
- **蓝绿部署**: 零停机迁移
- **灰度发布**: 逐步放量验证
- **监控告警**: 实时性能监控
- **应急预案**: 快速回滚机制

## 10. 运维指南

### 10.1 运维体系
- **监控告警**: Prometheus + Grafana + AlertManager
- **日志管理**: ELK Stack (Elasticsearch + Logstash + Kibana)
- **链路追踪**: Jaeger分布式追踪
- **健康检查**: Kubernetes健康探针 + Spring Boot Actuator
- **备份恢复**: 数据库定时备份 + 灾难恢复方案

### 10.2 部署流程
- **CI/CD流水线**: GitHub Actions/GitLab CI
- **容器镜像**: 自动构建 + 安全扫描
- **环境管理**: 开发 → 测试 → 预生产 → 生产
- **回滚策略**: 蓝绿部署 + 金丝雀发布

### 10.3 故障处理
- **应急预案**: 故障分级响应机制
- **容灾备份**: 多可用区部署 + 异地备份
- **性能调优**: 基于监控数据的性能优化


### 10.4 部署流程
```bash
# 1. 构建所有服务
docker-compose build

# 2. 运行测试
./gradlew test

# 3. 构建镜像
./gradlew bootBuildImage

# 4. 部署到K8s
helm install knowledge-platform ./helm/knowledge-platform

# 5. 验证部署
kubectl get pods
kubectl logs -f deployment/knowledge-graph-service
```

### 10.5 日常运维
- **日志查看**: kubectl logs -f <pod-name>
- **性能监控**: kubectl top pods
- **扩缩容**: kubectl scale deployment <service> --replicas=3
- **配置更新**: kubectl apply -f configmap.yaml

### 10.6 备份恢复
```bash
# Neo4j备份
kubectl exec -it neo4j-0 -- neo4j-admin database dump --to-path=/backup

# 恢复备份
kubectl exec -it neo4j-0 -- neo4j-admin database load --from-path=/backup
```

## 11. 技术演进路线

### 11.1 短期目标 (3个月)
- [ ] 完成核心微服务开发
- [ ] 搭建基础K8s环境
- [ ] 实现数据迁移
- [ ] 完成基本监控

### 11.2 中期目标 (6个月)
- [ ] 前端React重构完成
- [ ] 服务网格集成
- [ ] 高级分析功能
- [ ] 性能优化完成

### 11.3 长期目标 (12个月)
- [ ] 多云部署支持
- [ ] AI/ML集成
- [ ] 边缘计算支持
- [ ] 自动化运维
